using Microsoft.Extensions.Configuration;
using OrangePayrollAPI.Connections;
using OrangePayrollAPI.Model;
using System;
using System.Data;
using System.Data.SqlClient;

namespace OrangePayrollAPI.BusinessLayer
{
    public class Dashboard
    {
        ClsDataccess ObjclsDataccess;// = new ClsDataccess(IConfiguration config);
        EncryptDecryptAlgo ObjencryptDecryptAlgo;
        LogHelper logHelper;
        public Dashboard(IConfiguration config)
        {
            ObjclsDataccess = new ClsDataccess(config);
            ObjencryptDecryptAlgo = new EncryptDecryptAlgo();
            logHelper = new LogHelper();
        }

        public void LoginCheck(LoginModel login, ref DataSet dtLoginDetails)
        {
            try
            {
                SqlParameter[] sqlParams = new SqlParameter[]
                {
                   new SqlParameter("@UserName",Convert.ToString(login.UserName)),
                   new SqlParameter("@Password", ObjencryptDecryptAlgo.EncryptTripleDES(Convert.ToString(login.Password))),
                   new SqlParameter("@IMEINo", Convert.ToString(login.IMEINo)),
                   new SqlParameter("@DeviceID", Convert.ToString(login.DeviceID)),
                   new SqlParameter("@NewPassword", Convert.ToString("")),
                   new SqlParameter("@Login_ID",Convert.ToInt32("0")),
                   new SqlParameter("@Emp_ID",Convert.ToInt32("0")),
                   new SqlParameter("@Cmp_ID",Convert.ToInt32("0")),
                   new SqlParameter("@Type", Convert.ToString("L")),
                   new SqlParameter("@Result",Convert.ToString(""))
                };

                dtLoginDetails = ObjclsDataccess.ExecuteDataSet("SP_Mobile_HRMS_WebService_Login", sqlParams);
            }
            catch (Exception ex)
            {
                logHelper.Error("LoginCheck : " + ex.Message);
                throw;
            }
        }

        public void GetDeshBoardDetails(int EmpID, int CmpID, ref DataSet dtDashboardDetails)
        {
            try
            {
                SqlParameter[] sqlParams = new SqlParameter[]
                {
                   new SqlParameter("@Emp_ID",EmpID),
                   new SqlParameter("@Cmp_ID",CmpID)
                };

                dtDashboardDetails = ObjclsDataccess.ExecuteDataSet("SP_Mobile_HRMS_WebService_DASHBOARD", sqlParams);
            }
            catch (Exception ex)
            {
                logHelper.Error("GetDeshBoardDetails : " + ex.Message);
                throw;
            }
        }

        public void EmployeeDetails(int EmpID, int CmpID, string EmpCode, int VerticalID, int BranchID, int DepartmentID, string strType, ref DataSet dtEmpDetails)
        {
            try
            {
                SqlParameter[] sqlParams = new SqlParameter[]
                {
                   new SqlParameter("@Emp_ID",EmpID),
                   new SqlParameter("@Cmp_ID",CmpID),
                   new SqlParameter("@Vertical_ID",VerticalID),
                   new SqlParameter("@Emp_Code",Convert.ToString(EmpCode)),
                   new SqlParameter("@Address",""),
                   new SqlParameter("@City",""),
                   new SqlParameter("@State",""),
                   new SqlParameter("@Pincode",""),
                   new SqlParameter("@PhoneNo",""),
                   new SqlParameter("@MobileNo",""),
                   new SqlParameter("@Email",""),
                   new SqlParameter("@ImageName",""),
                   new SqlParameter("@Branch_ID",BranchID),
                   new SqlParameter("@Department_ID",DepartmentID),
                   new SqlParameter("@Type",strType),
                   new SqlParameter("@Result","")
                };

                dtEmpDetails = ObjclsDataccess.ExecuteDataSet("SP_Mobile_HRMS_WebService_EmpDetails", sqlParams);
            }
            catch (Exception ex)
            {
                logHelper.Error("EmployeeDetails : " + ex.Message);
                throw;
            }

        }
    }
}
